import{_ as S,u as B,r as c,x as E,j as v,o as n,c as u,F as h,P as w,S as x,Z as A,b as e,h as O,a as k,Q as T,f as b,d as j,X as P,w as Q,e as y,U as X,g as Z}from"./app.a72d9fff.js";import{a as q,A as z}from"./AppUsersTables.e1b829e3.js";import{A as J}from"./logo.04de8c7a.js";import{A as K}from"./AppEditor.3e23bc26.js";import{A as W}from"./AppHeader.537e466b.js";const Y={name:"AppRaceColumn",props:["raceId"],emits:["update"],setup(s,{emit:a}){const _=B(),t=c([]),m=c(0);return E(async()=>{const i=await v.get(`/api/admin/race/${s.raceId}`);t.value=i.data,m.value=Object.keys(t.value).length+1}),{submit:async()=>{try{await v.post(`/api/admin/race/${s.raceId}/results`,{result:t.value}),_.dispatch("notification/displayMessage",{value:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B",type:"primary"}),a("update")}catch{_.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043E\u043D\u043A\u0438",type:"error"})}},result:t,userAmount:m}}},$=["onUpdate:modelValue","placeholder"],tt={class:"race-table__item race-table__result"};function et(s,a,_,t,m,f){return n(),u(h,null,[(n(!0),u(h,null,w(t.result,(i,o)=>(n(),u("div",{class:"race-table__item race-table__result",key:o},[x(e("input",{type:"text","onUpdate:modelValue":g=>t.result[o]=g,placeholder:`(dnf, ${t.userAmount})`},null,8,$),[[A,t.result[o]]])]))),128)),e("div",tt,[e("button",{onClick:a[0]||(a[0]=(...i)=>t.submit&&t.submit(...i))},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])],64)}const at=S(Y,[["render",et]]),st={name:"AppRaceTable",props:["stageId","status","groupId"],components:{AppRaceColumn:at},setup(s){const a=c({}),_=c({}),t=c(),m=c(),f=c({default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"}),i=O(()=>{var d;return(d=Object.keys(a.value).length)!=null?d:0}),o=async()=>{try{const d=await v.get(`/api/admin/stage/${s.stageId}/${s.groupId}/${s.status}/total`);m.value=d.data}catch(d){console.log(d.message)}};return E(async()=>{try{const d=await v.get(`/api/admin/stage/${s.stageId}/races/${s.status}/group/${s.groupId}`);a.value=d.data,t.value=a.value[0].race_id;const p=await v.get(`/api/admin/race/${t.value}/users`);_.value=p.data,await o()}catch(d){console.log(d.message)}}),{raceData:a,raceAmount:i,usersData:_,addRace:async()=>{try{const p=(await v.post("/api/admin/race/create",{stage_id:s.stageId,group_id:s.groupId,status:s.status,lastRaceId:t.value})).data;a.value.push({race_id:p.id,group_id:p.group_id,status:p.status}),await o()}catch(d){console.log(d.message)}},remove:async d=>{try{await v.post(`/api/admin/race/${d}/remove`),a.value.splice(a.value.findIndex(p=>p.race_id===d),1),await o()}catch(p){console.log(p.message)}},totalData:m,getTotal:o,raceTitle:f}}},ot={class:"race-table"},rt={key:0},nt={class:"race-table__header"},lt={class:"race-table__row"},ct=e("div",{class:"race-table__item race-table__name"},"\u042F\u0445\u0442\u0441\u043C\u0435\u043D",-1),it=e("div",{class:"race-table__item race-table__total"},"\u0418\u0442\u043E\u0433",-1),dt={class:"race-table__body"},ut={class:"race-table__column"},_t={key:0,class:"race-table__item race-table__result"},pt=["onClick"],mt={class:"race-table__column"};function gt(s,a,_,t,m,f){const i=k("AppRaceColumn");return n(),u("div",ot,[s.$props.status?(n(),u("h2",rt,T(t.raceTitle[s.$props.status])+" #"+T(s.$props.groupId),1)):b("",!0),e("button",{class:"btn btn-default btn-settings mb15",onClick:a[0]||(a[0]=(...o)=>t.addRace&&t.addRace(...o))},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u043E\u043D\u043A\u0443"),e("div",nt,[e("div",lt,[ct,(n(!0),u(h,null,w(t.raceAmount,o=>(n(),u("div",{class:"race-table__item race-table__result",key:o},"#"+T(o),1))),128)),it])]),e("div",dt,[e("div",ut,[(n(!0),u(h,null,w(t.usersData,o=>(n(),u("div",{class:"race-table__item race-table__name",key:o.user_id},T(o.nickname),1))),128))]),(n(!0),u(h,null,w(t.raceData,(o,g)=>(n(),u("div",{class:"race-table__column",key:o.race_id},[j(i,{raceId:o.race_id,onUpdate:t.getTotal},null,8,["raceId","onUpdate"]),t.raceData.length>1&&g+1!==1?(n(),u("div",_t,[e("button",{onClick:U=>t.remove(o.race_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,pt)])):b("",!0)]))),128)),e("div",mt,[(n(!0),u(h,null,w(t.totalData,(o,g)=>(n(),u("div",{class:"race-table__item race-table__total",key:g},T(o),1))),128))])])])}const vt=S(st,[["render",gt]]),ft={name:"TheStageStatus",emits:["update"],props:["status","id"],setup(s,{emit:a}){const _=c(s.status),t=s.id,m=B();return{status:_,id:t,finishStage:async()=>{try{const i=await v.post(`/api/admin/stage/${t}/finish`);_.value=i.data.status,a("update",_.value)}catch(i){console.log(i.message),m.dispatch("notification/displayMessage",{value:i.response.data.message,type:"error"})}}}}};function bt(s,a,_,t,m,f){return t.status==="default"||t.status==="group"?(n(),u("button",{key:0,class:"btn btn-default btn-settings mb30",onClick:a[0]||(a[0]=(...i)=>t.finishStage&&t.finishStage(...i))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0440\u0435\u0433\u0430\u0442\u0443")):b("",!0)}const ht=S(ft,[["render",bt]]),yt={name:"stage.edit",components:{AppUsersTables:q,AppRaceTable:vt,TheStageStatus:ht,AppResultTable:z,AppLoader:J,AppEditor:K,AppHeader:W},setup(){const s=c(!1),a=P(),_=B(),t=a.params.id,m=c(),f=c(""),i=c(""),o=c(""),g=c(""),U=c(""),d=c(""),p=c(""),I=c(),l=c(),C=c(),R=c(),V=c(),D=c(null),L=c(),G=c(),M=c(),N=async r=>{try{const F=await v.get(`/api/admin/stage/${t}/meta`);L.value=F.data,l.value=r,G.value&&G.value.update(),M.value&&M.value.update()}catch(F){console.log(F.message)}},H=async()=>{try{const r=await v.get(`/api/admin/stage/${t}/edit`);I.value=r.data.users}catch(r){console.log(r.message)}};return E(async()=>{s.value=!0;try{const r=await v.get(`/api/admin/stage/${t}/edit`);g.value=m.value=r.data.title,f.value=r.data.register_start,i.value=r.data.register_end,o.value=r.data.race_start,U.value=r.data.excerpt?r.data.excerpt:" ",d.value=r.data.description?r.data.description:" ",p.value=r.data.participant_text?r.data.participant_text:" ",I.value=r.data.users,C.value=r.data.race_amount_drop,R.value=r.data.race_amount_group_drop,V.value=r.data.race_amount_fleet_drop,await N(r.data.status),s.value=!1,console.log("data",r.data)}catch(r){console.log(r.message),s.value=!1}}),{register_start:f,register_end:i,race_start:o,title:g,excerpt:U,description:d,submit:async()=>{s.value=!0;try{if(await v.patch(`/api/admin/stage/${t}/update`,{title:g.value,description:d.value,excerpt:U.value,participant_text:p.value,register_start:f.value,register_end:i.value,race_start:o.value,race_amount_drop:C.value,race_amount_group_drop:R.value,race_amount_fleet_drop:V.value}),D.value)for(let r of D.value)r.getTotal();_.dispatch("notification/displayMessage",{value:"\u042D\u0442\u0430\u043F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",type:"primary"}),s.value=!1}catch(r){console.log(r.message),_.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u0430\u043F\u0430",type:"error"}),s.value=!1}},users:I,status:l,id:t,statusGroup:L,child:D,stageStatusComponent:M,race_amount_drop:C,race_amount_group_drop:R,race_amount_fleet_drop:V,statusGroupFetch:N,usersFetch:H,resultComponent:G,h1:m,loading:s,participant_text:p}}},xt={class:"container-fluid g-0"},At={class:"row"},kt={class:"col-12"},Ut={class:"dashboard-item"},wt={class:"form-control"},Vt=e("label",{for:"register_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Tt={class:"form-control"},It=e("label",{for:"register_end"},"\u041A\u043E\u043D\u0435\u0446 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Ct={class:"form-control"},Rt=e("label",{for:"race_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0433\u043E\u043D\u043E\u043A",-1),St={class:"form-control"},Dt=e("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u042D\u0442\u0430\u043F\u0430",-1),Gt={class:"form-control"},Mt=e("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)",-1),Ft={class:"form-control"},Bt=e("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),Et={class:"form-control"},Lt=e("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),Nt={class:"form-control"},jt=e("label",{for:"excerpt"},"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),Ht={class:"form-control"},Ot=e("label",{for:"description"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),Pt={class:"form-control"},Qt=e("label",{for:"participant_text"},"\u0414\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432",-1),Xt=e("button",{class:"btn btn-default btn-settings"},"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",-1),Zt={class:"col-12"},qt={class:"dashboard-item"};function zt(s,a,_,t,m,f){const i=k("AppHeader"),o=k("AppLoader"),g=k("AppEditor"),U=k("AppUsersTables"),d=k("AppRaceTable"),p=k("TheStageStatus"),I=k("AppResultTable");return n(),u(h,null,[j(i,null,{default:Q(()=>[Z(T(t.h1),1)]),_:1}),e("main",null,[e("div",xt,[e("div",At,[e("div",kt,[e("div",Ut,[t.loading?(n(),y(o,{key:0})):b("",!0),e("form",{onSubmit:a[10]||(a[10]=X((...l)=>t.submit&&t.submit(...l),["prevent"]))},[e("div",wt,[Vt,x(e("input",{class:"form-input",type:"datetime-local",id:"register_start","onUpdate:modelValue":a[0]||(a[0]=l=>t.register_start=l)},null,512),[[A,t.register_start]])]),e("div",Tt,[It,x(e("input",{class:"form-input",type:"datetime-local",id:"register_end","onUpdate:modelValue":a[1]||(a[1]=l=>t.register_end=l)},null,512),[[A,t.register_end]])]),e("div",Ct,[Rt,x(e("input",{class:"form-input",type:"datetime-local",id:"race_start","onUpdate:modelValue":a[2]||(a[2]=l=>t.race_start=l)},null,512),[[A,t.race_start]])]),e("div",St,[Dt,x(e("input",{class:"form-input",type:"text",id:"title","onUpdate:modelValue":a[3]||(a[3]=l=>t.title=l),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u044D\u0442\u0430\u043F\u0430"},null,512),[[A,t.title]])]),e("div",Gt,[Mt,x(e("input",{class:"form-input",type:"text",id:"race_amount_drop","onUpdate:modelValue":a[4]||(a[4]=l=>t.race_amount_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[A,t.race_amount_drop]])]),e("div",Ft,[Bt,x(e("input",{class:"form-input",type:"text",id:"race_amount_group_drop","onUpdate:modelValue":a[5]||(a[5]=l=>t.race_amount_group_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[A,t.race_amount_group_drop]])]),e("div",Et,[Lt,x(e("input",{class:"form-input",type:"text",id:"race_amount_fleet_drop","onUpdate:modelValue":a[6]||(a[6]=l=>t.race_amount_fleet_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[A,t.race_amount_fleet_drop]])]),e("div",Nt,[jt,t.excerpt?(n(),y(g,{key:0,modelValue:t.excerpt,"onUpdate:modelValue":a[7]||(a[7]=l=>t.excerpt=l),id:"excerpt"},null,8,["modelValue"])):b("",!0)]),e("div",Ht,[Ot,t.description?(n(),y(g,{key:0,modelValue:t.description,"onUpdate:modelValue":a[8]||(a[8]=l=>t.description=l),id:"description"},null,8,["modelValue"])):b("",!0)]),e("div",Pt,[Qt,t.participant_text?(n(),y(g,{key:0,modelValue:t.participant_text,"onUpdate:modelValue":a[9]||(a[9]=l=>t.participant_text=l),id:"participant_text"},null,8,["modelValue"])):b("",!0)]),Xt],32)])]),e("div",Zt,[e("div",qt,[t.status==="active"&&t.users?(n(),y(U,{key:0,users:t.users,id:t.id,status:t.status,onCreateGroups:t.statusGroupFetch,onUsersUpdated:t.usersFetch},null,8,["users","id","status","onCreateGroups","onUsersUpdated"])):b("",!0),t.status!=="finished"&&t.status!=="active"?(n(!0),u(h,{key:1},w(t.statusGroup,(l,C,R)=>(n(),u("div",{class:"stage-table",key:R},[(n(!0),u(h,null,w(l,V=>(n(),y(d,{stageId:t.id,groupId:V,status:C,key:V,ref_for:!0,ref:"child"},null,8,["stageId","groupId","status"]))),128))]))),128)):b("",!0),t.status!=="active"?(n(),y(p,{key:2,status:t.status,id:t.id,onUpdate:t.statusGroupFetch,ref:"stageStatusComponent"},null,8,["status","id","onUpdate"])):b("",!0),t.status!=="active"?(n(),y(I,{key:3,id:t.id,ref:"resultComponent"},null,8,["id"])):b("",!0)])])])])])],64)}const ee=S(yt,[["render",zt]]);export{ee as default};
