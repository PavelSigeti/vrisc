import{_ as M,r as k,x as V,o as n,c as l,F as f,P as g,Q as c,f as x,b as t,g as S,Y as U,u as w,S as I,Z as A,I as G,J as N}from"./app.a72d9fff.js";const C={name:"AppResultTable",props:["id"],setup(_){const m=k(),r={default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"};return V(async()=>{try{const u=await axios.get(`/api/stage/${_.id}`);m.value=u.data}catch(u){console.log(u.message)}}),{results:m,statusTitle:r,printValue:(u,d,b)=>{var h;return u.null?"\u2014":u.drop?u.place===b+1?`(dnf, ${b+1})`:`(${u.place})`:(h=u.place)!=null?h:d}}}},E={class:"result-tables"},q={key:0},B={class:"result-table"},D=t("th",null,"#",-1),R=t("th",null,"\u042F\u0445\u0442\u0441\u043C\u0435\u043D",-1),j=t("th",null,"\u0418\u0442\u043E\u0433",-1),F={class:"result-table__name"},O={class:"result-table__nick"};function J(_,m,r,o,u,d){return n(),l("div",E,[(n(!0),l(f,null,g(o.results,(b,h)=>(n(),l("div",{class:"result-table__container",key:h},[(n(!0),l(f,null,g(b,(y,$,i)=>(n(),l("div",{class:"result-table__item",key:$},[o.statusTitle[h]!=="\u0413\u043E\u043D\u043A\u0430"?(n(),l("h3",q,c(o.statusTitle[h])+" #"+c(i+1),1)):x("",!0),t("table",B,[t("thead",null,[t("tr",null,[D,R,(n(!0),l(f,null,g(Object.keys(y[0]).length-1,e=>(n(),l("th",null," #"+c(e),1))),256)),j])]),t("tbody",null,[(n(!0),l(f,null,g(y,(e,a)=>(n(),l("tr",null,[t("td",null,c(a+1),1),t("td",null,[t("div",F,[S(c(e[0].name)+" "+c(e[0].surname)+" ",1),t("span",O,c(e[0].nickname),1)])]),(n(!0),l(f,null,g(e,s=>(n(),l("td",null,c(o.printValue(s,e.sum,y.length)),1))),256))]))),256))])])]))),128))]))),128))])}const X=M(C,[["render",J]]);const L=_=>(G("data-v-56b1adff"),_=_(),N(),_),P={key:0,class:"result-table"},Q=L(()=>t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"\u042F\u0445\u0442\u0441\u043C\u0435\u043D"),t("th",null,"\u0413\u0440\u0443\u043F\u043F\u0430"),t("th",null,"\u0423\u0434\u0430\u043B\u0435\u043D\u0438\u0435")])],-1)),Y={class:"result-table__name"},Z={class:"result-table__nick"},z=["onUpdate:modelValue"],H=["onClick"],K={__name:"AppUsersTables",props:{id:{type:[String,Number],required:!0},users:{type:Array,default:()=>[]},status:{type:String,required:!0}},emits:["create-groups","users-updated"],setup(_,{emit:m}){const r=_;U();const o=w(),u=k(r.status),d=k({});(i=>{const e={};i&&i.length>0&&i.forEach(a=>{e[a.id]=1}),d.value=e})(r.users);const h=()=>{if(!r.users.every(s=>d.value[s.id]!==void 0&&d.value[s.id]!==null&&d.value[s.id]>=1))return o.dispatch("notification/displayMessage",{type:"error",value:"\u041D\u0435 \u0432\u0441\u0435 \u044F\u0445\u0442\u0441\u043C\u0435\u043D\u044B \u0440\u0430\u0441\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u044B \u043F\u043E \u0433\u0440\u0443\u043F\u043F\u0430\u043C"}),!1;const e=Object.values(d.value),a=[...new Set(e)].sort((s,p)=>s-p);for(let s=0;s<a.length;s++)if(a[s]!==s+1)return o.dispatch("notification/displayMessage",{type:"error",value:`\u041D\u043E\u043C\u0435\u0440\u0430 \u0433\u0440\u0443\u043F\u043F \u0434\u043E\u043B\u0436\u043D\u044B \u043D\u0430\u0447\u0438\u043D\u0430\u0442\u044C\u0441\u044F \u0441 1 \u0438 \u0438\u0434\u0442\u0438 \u043F\u043E\u0441\u043B\u0435\u0434\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u043D\u043E. \u041E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u0430 \u0433\u0440\u0443\u043F\u043F\u0430 \u2116${a[s]}`}),!1;return!0},y=async()=>{var i,e,a,s;try{if(!h())return;const p={};r.users.forEach(T=>{p[T.id]=parseInt(d.value[T.id])||1});const v=await axios.post(`/api/admin/stage/${r.id}/create-manual-groups`,{groups:p});v.data.result?(u.value=v.data.status,m("create-groups",v.data.status),o.dispatch("notification/displayMessage",{type:"primary",value:"\u0413\u0440\u0443\u043F\u043F\u044B \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0441\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0438 \u044D\u0442\u0430\u043F \u043D\u0430\u0447\u0430\u0442"})):o.dispatch("notification/displayMessage",{type:"error",value:v.data.msg||v.data.error||"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0438 \u0433\u0440\u0443\u043F\u043F"})}catch(p){console.error("Error creating groups:",p),o.dispatch("notification/displayMessage",{type:"error",value:((e=(i=p.response)==null?void 0:i.data)==null?void 0:e.message)||((s=(a=p.response)==null?void 0:a.data)==null?void 0:s.msg)||"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430"})}},$=async i=>{const e=await axios.post(`/api/admin/stage/${r.id}/remove-user/${i}`);e.data.result?(m("users-updated"),o.dispatch("notification/displayMessage",{type:"primary",value:"\u0423\u0447\u0430\u0441\u0442\u043D\u0438\u043A \u0443\u0434\u0430\u043B\u0435\u043D"})):o.dispatch("notification/displayMessage",{type:"error",value:e.data.msg})};return(i,e)=>(n(),l(f,null,[r.users&&r.users.length>0?(n(),l("table",P,[Q,t("tbody",null,[(n(!0),l(f,null,g(r.users,(a,s)=>(n(),l("tr",{key:a.id||s},[t("td",null,c(s+1),1),t("td",null,[t("div",Y,[S(c(a.surname)+" "+c(a.name)+" ",1),t("span",Z,c(a.nickname),1)])]),t("td",null,[I(t("input",{class:"split-number-input",type:"number","onUpdate:modelValue":p=>d.value[a.id]=p,min:"1"},null,8,z),[[A,d.value[a.id]]])]),t("td",null,[t("button",{class:"btn btn-default btn-settings",onClick:p=>$(a.id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,H)])]))),128))])])):x("",!0),r.users&&r.users.length>0?(n(),l("button",{key:1,class:"btn btn-default btn-settings mt15",onClick:y}," \u0421\u0444\u043E\u0440\u043C\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u044B ")):x("",!0)],64))}},tt=M(K,[["__scopeId","data-v-56b1adff"]]);export{X as A,tt as a};
