import{_ as C,u as B,r as i,i as E,h as f,o,c as _,F as h,P as w,S as k,Y as x,b as a,j,a as A,Q as T,f as v,d as N,X as H,w as O,e as y,U as P,g as Q}from"./app.08e4a853.js";import{a as X,A as Y}from"./AppUsersTables.d1c0410b.js";import{A as q}from"./logo.170de005.js";import{A as z}from"./AppEditor.796df726.js";import{A as J}from"./AppHeader.38a9a9cf.js";const K={name:"AppRaceColumn",props:["raceId"],emits:["update"],setup(s,{emit:e}){const p=B(),t=i([]),m=i(0);return E(async()=>{const d=await f.get(`/api/admin/race/${s.raceId}`);t.value=d.data,m.value=Object.keys(t.value).length+1}),{submit:async()=>{try{await f.post(`/api/admin/race/${s.raceId}/results`,{result:t.value}),p.dispatch("notification/displayMessage",{value:"\u0414\u0430\u043D\u043D\u044B\u0435 \u0433\u043E\u043D\u043A\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u044B",type:"primary"}),e("update")}catch{p.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u0434\u0430\u043D\u043D\u044B\u0445 \u0433\u043E\u043D\u043A\u0438",type:"error"})}},result:t,userAmount:m}}},W=["onUpdate:modelValue","placeholder"],Z={class:"race-table__item race-table__result"};function $(s,e,p,t,m,b){return o(),_(h,null,[(o(!0),_(h,null,w(t.result,(d,r)=>(o(),_("div",{class:"race-table__item race-table__result",key:r},[k(a("input",{type:"text","onUpdate:modelValue":n=>t.result[r]=n,placeholder:`(dnf, ${t.userAmount})`},null,8,W),[[x,t.result[r]]])]))),128)),a("div",Z,[a("button",{onClick:e[0]||(e[0]=(...d)=>t.submit&&t.submit(...d))},"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C")])],64)}const tt=C(K,[["render",$]]),et={name:"AppRaceTable",props:["stageId","status","groupId"],components:{AppRaceColumn:tt},setup(s){const e=i({}),p=i({}),t=i(),m=i(),b=i({default:"\u0413\u043E\u043D\u043A\u0430",group:"\u0413\u0440\u0443\u043F\u043F\u0430",fleet:"\u0424\u043B\u043E\u0442"}),d=j(()=>{var u;return(u=Object.keys(e.value).length)!=null?u:0}),r=async()=>{try{const u=await f.get(`/api/admin/stage/${s.stageId}/${s.groupId}/${s.status}/total`);m.value=u.data}catch(u){console.log(u.message)}};return E(async()=>{try{const u=await f.get(`/api/admin/stage/${s.stageId}/races/${s.status}/group/${s.groupId}`);e.value=u.data,t.value=e.value[0].race_id;const g=await f.get(`/api/admin/race/${t.value}/users`);p.value=g.data,await r()}catch(u){console.log(u.message)}}),{raceData:e,raceAmount:d,usersData:p,addRace:async()=>{try{const g=(await f.post("/api/admin/race/create",{stage_id:s.stageId,group_id:s.groupId,status:s.status,lastRaceId:t.value})).data;e.value.push({race_id:g.id,group_id:g.group_id,status:g.status}),await r()}catch(u){console.log(u.message)}},remove:async u=>{try{await f.post(`/api/admin/race/${u}/remove`),e.value.splice(e.value.findIndex(g=>g.race_id===u),1),await r()}catch(g){console.log(g.message)}},totalData:m,getTotal:r,raceTitle:b}}},at={class:"race-table"},st={key:0},ot={class:"race-table__header"},rt={class:"race-table__row"},nt=a("div",{class:"race-table__item race-table__name"},"\u042F\u0445\u0442\u0441\u043C\u0435\u043D",-1),lt=a("div",{class:"race-table__item race-table__total"},"\u0418\u0442\u043E\u0433",-1),it={class:"race-table__body"},ct={class:"race-table__column"},dt={key:0,class:"race-table__item race-table__result"},ut=["onClick"],_t={class:"race-table__column"};function pt(s,e,p,t,m,b){const d=A("AppRaceColumn");return o(),_("div",at,[s.$props.status?(o(),_("h2",st,T(t.raceTitle[s.$props.status])+" #"+T(s.$props.groupId),1)):v("",!0),a("button",{class:"btn btn-default btn-settings mb15",onClick:e[0]||(e[0]=(...r)=>t.addRace&&t.addRace(...r))},"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0433\u043E\u043D\u043A\u0443"),a("div",ot,[a("div",rt,[nt,(o(!0),_(h,null,w(t.raceAmount,r=>(o(),_("div",{class:"race-table__item race-table__result",key:r},"#"+T(r),1))),128)),lt])]),a("div",it,[a("div",ct,[(o(!0),_(h,null,w(t.usersData,r=>(o(),_("div",{class:"race-table__item race-table__name",key:r.user_id},T(r.nickname),1))),128))]),(o(!0),_(h,null,w(t.raceData,(r,n)=>(o(),_("div",{class:"race-table__column",key:r.race_id},[N(d,{raceId:r.race_id,onUpdate:t.getTotal},null,8,["raceId","onUpdate"]),t.raceData.length>1&&n+1!==1?(o(),_("div",dt,[a("button",{onClick:S=>t.remove(r.race_id)},"\u0423\u0434\u0430\u043B\u0438\u0442\u044C",8,ut)])):v("",!0)]))),128)),a("div",_t,[(o(!0),_(h,null,w(t.totalData,(r,n)=>(o(),_("div",{class:"race-table__item race-table__total",key:n},T(r),1))),128))])])])}const mt=C(et,[["render",pt]]),gt={name:"TheStageStatus",emits:["update"],props:["status","id"],setup(s,{emit:e}){const p=i(s.status),t=s.id,m=B();return{status:p,startStage:async()=>{try{const n=await f.post(`/api/admin/stage/${t}/start`);p.value=n.data.status,e("update",p.value)}catch(n){console.log(n.message),m.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"})}},finishGroupStage:async()=>{try{const n=await f.post(`/api/admin/stage/${t}/finish-group`);p.value=n.data.status,e("update",p.value)}catch(n){console.log(n.message),m.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"})}},id:t,finishStage:async()=>{try{const n=await f.post(`/api/admin/stage/${t}/finish`);p.value=n.data.status,e("update",p.value)}catch(n){console.log(n.message),m.dispatch("notification/displayMessage",{value:n.response.data.message,type:"error"})}}}}};function vt(s,e,p,t,m,b){return o(),_(h,null,[t.status==="active"?(o(),_("button",{key:0,class:"btn btn-default btn-settings mb30",onClick:e[0]||(e[0]=(...d)=>t.startStage&&t.startStage(...d))},"\u041D\u0430\u0447\u0430\u0442\u044C \u044D\u0442\u0430\u043F")):v("",!0),t.status==="group"?(o(),_("button",{key:1,class:"btn btn-default btn-settings mb30",onClick:e[1]||(e[1]=(...d)=>t.finishGroupStage&&t.finishGroupStage(...d))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0433\u0440\u0443\u043F\u043F\u043E\u0432\u043E\u0439 \u044D\u0442\u0430\u043F")):v("",!0),t.status==="default"||t.status==="fleet"?(o(),_("button",{key:2,class:"btn btn-default btn-settings mb30",onClick:e[2]||(e[2]=(...d)=>t.finishStage&&t.finishStage(...d))},"\u0417\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u044C \u0440\u0435\u0433\u0430\u0442\u0443")):v("",!0)],64)}const ft=C(gt,[["render",vt]]),bt={name:"stage.edit",components:{AppUsersTables:X,AppRaceTable:mt,TheStageStatus:ft,AppResultTable:Y,AppLoader:q,AppEditor:z,AppHeader:J},setup(){const s=i(!1),e=H(),p=B(),t=e.params.id,m=i(),b=i(""),d=i(""),r=i(""),n=i(""),S=i(""),u=i(""),g=i(""),R=i(),l=i(),I=i(),U=i(),V=i(),D=i(null),F=i(),M=i(),L=async c=>{try{const G=await f.get(`/api/admin/stage/${t}/meta`);F.value=G.data,l.value=c,M.value&&M.value.update()}catch(G){console.log(G.message)}};return E(async()=>{s.value=!0;try{const c=await f.get(`/api/admin/stage/${t}/edit`);n.value=m.value=c.data.title,b.value=c.data.register_start,d.value=c.data.register_end,r.value=c.data.race_start,S.value=c.data.excerpt?c.data.excerpt:" ",u.value=c.data.description?c.data.description:" ",g.value=c.data.participant_text?c.data.participant_text:" ",R.value=c.data.users,I.value=c.data.race_amount_drop,U.value=c.data.race_amount_group_drop,V.value=c.data.race_amount_fleet_drop,await L(c.data.status),s.value=!1,console.log("data",c.data)}catch(c){console.log(c.message),s.value=!1}}),{register_start:b,register_end:d,race_start:r,title:n,excerpt:S,description:u,submit:async()=>{s.value=!0;try{if(await f.patch(`/api/admin/stage/${t}/update`,{title:n.value,description:u.value,excerpt:S.value,participant_text:g.value,register_start:b.value,register_end:d.value,race_start:r.value,race_amount_drop:I.value,race_amount_group_drop:U.value,race_amount_fleet_drop:V.value}),D.value)for(let c of D.value)c.getTotal();p.dispatch("notification/displayMessage",{value:"\u042D\u0442\u0430\u043F \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D",type:"primary"}),s.value=!1}catch(c){console.log(c.message),p.dispatch("notification/displayMessage",{value:"\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0438 \u044D\u0442\u0430\u043F\u0430",type:"error"}),s.value=!1}},users:R,status:l,id:t,statusGroup:F,child:D,race_amount_drop:I,race_amount_group_drop:U,race_amount_fleet_drop:V,statusGroupFetch:L,resultComponent:M,h1:m,loading:s,participant_text:g}}},ht={class:"container-fluid g-0"},yt={class:"row"},kt={class:"col-12"},xt={class:"dashboard-item"},At={class:"form-control"},St=a("label",{for:"register_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),wt={class:"form-control"},Vt=a("label",{for:"register_end"},"\u041A\u043E\u043D\u0435\u0446 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438",-1),Tt={class:"form-control"},It=a("label",{for:"race_start"},"\u041D\u0430\u0447\u0430\u043B\u043E \u0433\u043E\u043D\u043E\u043A",-1),Ut={class:"form-control"},Rt=a("label",{for:"title"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u042D\u0442\u0430\u043F\u0430",-1),Ct={class:"form-control"},Dt=a("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)",-1),Mt={class:"form-control"},Gt=a("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),Bt={class:"form-control"},Et=a("label",{for:"race_amount_drop"},"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)",-1),Ft={class:"form-control"},Lt=a("label",{for:"excerpt"},"\u041A\u0440\u0430\u0442\u043A\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),Nt={class:"form-control"},jt=a("label",{for:"description"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",-1),Ht={class:"form-control"},Ot=a("label",{for:"participant_text"},"\u0414\u043B\u044F \u0443\u0447\u0430\u0441\u0442\u043D\u0438\u043A\u043E\u0432",-1),Pt=a("button",{class:"btn btn-default btn-settings"},"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C",-1),Qt={class:"col-12"},Xt={class:"dashboard-item"};function Yt(s,e,p,t,m,b){const d=A("AppHeader"),r=A("AppLoader"),n=A("AppEditor"),S=A("AppUsersTables"),u=A("AppRaceTable"),g=A("TheStageStatus"),R=A("AppResultTable");return o(),_(h,null,[N(d,null,{default:O(()=>[Q(T(t.h1),1)]),_:1}),a("main",null,[a("div",ht,[a("div",yt,[a("div",kt,[a("div",xt,[t.loading?(o(),y(r,{key:0})):v("",!0),a("form",{onSubmit:e[10]||(e[10]=P((...l)=>t.submit&&t.submit(...l),["prevent"]))},[a("div",At,[St,k(a("input",{class:"form-input",type:"datetime-local",id:"register_start","onUpdate:modelValue":e[0]||(e[0]=l=>t.register_start=l)},null,512),[[x,t.register_start]])]),a("div",wt,[Vt,k(a("input",{class:"form-input",type:"datetime-local",id:"register_end","onUpdate:modelValue":e[1]||(e[1]=l=>t.register_end=l)},null,512),[[x,t.register_end]])]),a("div",Tt,[It,k(a("input",{class:"form-input",type:"datetime-local",id:"race_start","onUpdate:modelValue":e[2]||(e[2]=l=>t.race_start=l)},null,512),[[x,t.race_start]])]),a("div",Ut,[Rt,k(a("input",{class:"form-input",type:"text",id:"title","onUpdate:modelValue":e[3]||(e[3]=l=>t.title=l),placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u044D\u0442\u0430\u043F\u0430"},null,512),[[x,t.title]])]),a("div",Ct,[Dt,k(a("input",{class:"form-input",type:"text",id:"race_amount_drop","onUpdate:modelValue":e[4]||(e[4]=l=>t.race_amount_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 (\u0434\u043E 18 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[x,t.race_amount_drop]])]),a("div",Mt,[Gt,k(a("input",{class:"form-input",type:"text",id:"race_amount_group_drop","onUpdate:modelValue":e[5]||(e[5]=l=>t.race_amount_group_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432 \u0433\u0440\u0443\u043F\u043F\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[x,t.race_amount_group_drop]])]),a("div",Bt,[Et,k(a("input",{class:"form-input",type:"text",id:"race_amount_fleet_drop","onUpdate:modelValue":e[6]||(e[6]=l=>t.race_amount_fleet_drop=l),placeholder:"\u041A\u043E\u043B-\u0432\u043E \u0432\u044B\u0431\u0440\u043E\u0441\u043E\u0432 \u0432\u043E \u0444\u043B\u043E\u0442\u0430\u0445 (\u043E\u0442 19 \u0447\u0435\u043B\u043E\u0432)"},null,512),[[x,t.race_amount_fleet_drop]])]),a("div",Ft,[Lt,t.excerpt?(o(),y(n,{key:0,modelValue:t.excerpt,"onUpdate:modelValue":e[7]||(e[7]=l=>t.excerpt=l),id:"excerpt"},null,8,["modelValue"])):v("",!0)]),a("div",Nt,[jt,t.description?(o(),y(n,{key:0,modelValue:t.description,"onUpdate:modelValue":e[8]||(e[8]=l=>t.description=l),id:"description"},null,8,["modelValue"])):v("",!0)]),a("div",Ht,[Ot,t.participant_text?(o(),y(n,{key:0,modelValue:t.participant_text,"onUpdate:modelValue":e[9]||(e[9]=l=>t.participant_text=l),id:"participant_text"},null,8,["modelValue"])):v("",!0)]),Pt],32)])]),a("div",Qt,[a("div",Xt,[t.status==="active"&&t.users?(o(),y(S,{key:0,users:t.users},null,8,["users"])):v("",!0),t.status!=="finished"&&t.status!=="active"?(o(!0),_(h,{key:1},w(t.statusGroup,(l,I,U)=>(o(),_("div",{class:"stage-table",key:U},[(o(!0),_(h,null,w(l,V=>(o(),y(u,{stageId:t.id,groupId:V,status:I,key:V,ref_for:!0,ref:"child"},null,8,["stageId","groupId","status"]))),128))]))),128)):v("",!0),t.status?(o(),y(g,{key:2,status:t.status,id:t.id,onUpdate:t.statusGroupFetch},null,8,["status","id","onUpdate"])):v("",!0),t.status!=="active"?(o(),y(R,{key:3,id:t.id,ref:"resultComponent"},null,8,["id"])):v("",!0)])])])])])],64)}const $t=C(bt,[["render",Yt]]);export{$t as default};
